<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>이미지 변환 테스트</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .preview { max-width: 300px; margin: 10px 0; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <div class="container">
        <h1>이미지 변환 테스트</h1>
        
        <div>
            <h2>이미지 선택</h2>
            <input type="file" id="imageInput" accept="image/*">
        </div>

        <div>
            <h2>원본 이미지</h2>
            <img id="originalImage" class="preview">
        </div>

        <div>
            <h2>변환 테스트</h2>
            <button id="testAvif">AVIF 변환 테스트</button>
            <button id="testHeif">HEIF 변환 테스트</button>
        </div>

        <div id="result">
            <h2>결과</h2>
            <div id="resultMessage"></div>
            <img id="convertedImage" class="preview">
        </div>
    </div>

    <script>
        // 테스트 스크립트
        document.addEventListener('DOMContentLoaded', function() {
            const imageInput = document.getElementById('imageInput');
            const originalImage = document.getElementById('originalImage');
            const testAvifBtn = document.getElementById('testAvif');
            const testHeifBtn = document.getElementById('testHeif');
            const resultMessage = document.getElementById('resultMessage');
            const convertedImage = document.getElementById('convertedImage');

            // 이미지 선택 처리
            imageInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        originalImage.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });

            // AVIF 변환 테스트
            testAvifBtn.addEventListener('click', async function() {
                try {
                    const canvas = await imageToCanvas(originalImage);
                    
                    // 서버로 이미지 데이터 전송하여 AVIF로 변환
                    const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
                    
                    // 여기서는 실제 변환 대신 PNG를 사용 (서버 측 변환이 필요)
                    // 실제 구현에서는 서버에 전송하여 AVIF로 변환 후 받아야 함
                    const url = URL.createObjectURL(blob);
                    convertedImage.src = url;
                    resultMessage.innerHTML = '<span class="success">이미지 준비 완료 (서버 측 AVIF 변환 필요)</span>';
                } catch (error) {
                    resultMessage.innerHTML = `<span class="error">이미지 처리 실패: ${error.message}</span>`;
                }
            });

            // HEIF 변환 테스트
            testHeifBtn.addEventListener('click', async function() {
                try {
                    const canvas = await imageToCanvas(originalImage);
                    
                    // 서버로 이미지 데이터 전송하여 HEIF로 변환
                    const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
                    
                    // 여기서는 실제 변환 대신 PNG를 사용 (서버 측 변환이 필요)
                    // 실제 구현에서는 서버에 전송하여 HEIF로 변환 후 받아야 함
                    const url = URL.createObjectURL(blob);
                    convertedImage.src = url;
                    resultMessage.innerHTML = '<span class="success">이미지 준비 완료 (서버 측 HEIF 변환 필요)</span>';
                } catch (error) {
                    resultMessage.innerHTML = `<span class="error">이미지 처리 실패: ${error.message}</span>`;
                }
            });
        });

        // 이미지를 캔버스로 변환
        async function imageToCanvas(img) {
            return new Promise((resolve, reject) => {
                if (!img.complete || !img.naturalWidth) {
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        canvas.width = img.naturalWidth;
                        canvas.height = img.naturalHeight;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);
                        resolve(canvas);
                    };
                    img.onerror = () => reject(new Error('이미지 로드 실패'));
                } else {
                    const canvas = document.createElement('canvas');
                    canvas.width = img.naturalWidth;
                    canvas.height = img.naturalHeight;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);
                    resolve(canvas);
                }
            });
        }
    </script>
</body>
</html> 